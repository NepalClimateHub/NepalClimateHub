---
export const prerender = true;

import '../../styles/global.css';
import ConnectCard from '@components/ConnectCard.astro';
import FeaturedEventSection from '@components/FeaturedEventSection.astro';
import Footer from '@components/Footer.astro';
import Header from '@components/Header.astro';
import CardDetailSection from '@layouts/CardDetailSection.astro';
import BaseLayout from '../../layouts/Layout.astro';
import { createSlug } from '../../utils/slug';

// Import the same JSON file that's used in the events page
import eventJSON from '../../data/dummy-event.json';

export async function getStaticPaths() {
  // Generate paths for each event, creating slugs from titles
  return eventJSON.map((event) => {
    // Create a slug from the title
    const slug = createSlug(event.title);
    
    return {
      params: { eventDetail: slug },
      props: { event: { ...event } }
    };
  });
}

const { eventDetail } = Astro.params;
const { event } = Astro.props;

// Fallback to finding the event by matching the slug with a generated slug from the title
const eventData = event || eventJSON.find((e) => createSlug(e.title) === eventDetail);
---

<BaseLayout title={`${eventData.title} | Nepal Climate Hub`}>
	<main class="main-container">
		<!-- header section  -->
		<section class="header-section">
			<Header logoColor="#1A1B1E" />

			<!-- a mini navbar -->
			<div class="mini-nav">
				<a href="/">Home</a>
				<span style="color: #364FC7">/</span>
				<a href="/events">Events</a>
			</div>
		</section>

    <section class="organization-card-section">
      <CardDetailSection cardId={0} organization="false" dataObj={eventData} />
    </section>

		<section class="connect-card-section">
			<ConnectCard cardId={0} organization="false" dataObj={eventData} />
		</section>

		<section class="organization-section">
			<FeaturedEventSection startIndex={0} endIndex={4} title="Join other events" />
		</section>

		<section class="footer-section">
			<Footer />
		</section>
	</main>
</BaseLayout>

<style>
	section {
	 padding: 0px 48px;
 }

 .connect-card-section {
    background-color: #CEFE00;
  }

	.footer-section {
    background-color: #1A1B1E;
    color: white;
  }

 @media screen and (max-width: 768px) {
  section {
    padding: 0px;
  }
}
</style>

