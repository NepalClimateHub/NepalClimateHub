---
import '../../styles/global.css';
import ConnectCard from '../../components/ConnectCard.astro';
import FeaturedOrganizationSection from '../../components/FeaturedOrganizationSection.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import CardDetailSection from '../../layouts/CardDetailSection.astro';
import BaseLayout from '../../layouts/Layout.astro';

import organizationsJSON from '../../data/organizations.json';

// Add getStaticPaths for static generation
export function getStaticPaths() {
  return organizationsJSON.map((organization) => ({
    params: { organizationName: organization.slug },
    props: { organization }
  }));
}

// Get the organization from props
const { organization } = Astro.props;
const { organizationName } = Astro.params;

if (!organization) {
  throw new Error(`Organization with slug ${organizationName} not found`);
}

// Prepare meta tags
function stripHtml(html: string): string {
  return html.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
}

const siteUrl = Astro.site || "https://nepalclimatehub.org";
const pathname = Astro.url.pathname;
const search = Astro.url.search;
const hash = Astro.url.hash;
const fullPath = `${pathname}${search}${hash}`;
const metaDescription = stripHtml(organization.description) || `${organization.name} - ${organization.address || 'Climate organization in Nepal'}`;
const metaImage = organization.pictures && organization.pictures.length > 0 
  ? organization.pictures[0] 
  : '/favicon.png';
const metaUrl = `${siteUrl}${fullPath}`;
---

<BaseLayout 
  title={`${organization.name} | Nepal Climate Hub`}
  description={metaDescription}
  ogImage={metaImage}
  ogUrl={metaUrl}
>
	<main class="main-container">
		<!-- header section  -->

		<section class="header-section">
			<Header logoColor="#1A1B1E" />
 
			<!-- a mini navbar -->
			<div class="mini-nav">
				<a href="/">Home</a>
				<span style="color: #364FC7">/</span>
				<a href="/organizations">Organizations</a>
			</div>
		</section>

    <section class="organization-card-section">
      <CardDetailSection organization={true} dataObj = {organization}/>
    </section>

		<section class="connect-card-section">
			<ConnectCard organization={true} dataObj = {organization} />
		</section>

		<section class="organization-section">
			<FeaturedOrganizationSection startIndex = 0 endIndex = 4 title="Similar Organizations" />
		</section>

		<section class="footer-section">
			<Footer />
		</section>
	</main>
</BaseLayout>

<style>
	section {
	 padding: 0px 48px;
 }

 .connect-card-section {
    background-color: #CEFE00;
  }

	.footer-section {
    background-color: #1A1B1E;
    color: white;
  }

 @media  screen and (max-width: 768px) {
  section {
    padding: 0px;
  }
}

</style>