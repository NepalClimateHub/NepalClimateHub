---
export const prerender = true;

import '../../styles/global.css';
import ConnectCard from '@components/ConnectCard.astro';
import FeaturedOpportunitySection from '@components/FeaturedOpportunitySection.astro';
import Footer from '@components/Footer.astro';
import Header from '@components/Header.astro';
import CardDetailSection from '@layouts/CardDetailSection.astro';
import BaseLayout from '../../layouts/Layout.astro';
import { createSlug } from '../../utils/slug';

import opportunitiesJSON from '../../data/dummy-opportunity.json';

export async function getStaticPaths() {
  return opportunitiesJSON.map((opportunity) => {
    const slug = createSlug(opportunity.title);
    return {
      params: { detail: slug },
      props: { opportunity: { ...opportunity } }
    };
  });
}

const { detail } = Astro.params;
const { opportunity } = Astro.props;
const opportunityDetail = opportunity || opportunitiesJSON.find((o) => createSlug(o.title) === detail);
---

<BaseLayout title={`${opportunityDetail.title} | Nepal Climate Hub`}>
  <main class="main-container">
    <!-- Header Section -->
    <section class="header-section">
      <Header logoColor="#1A1B1E" />
      <div class="mini-nav">
        <a href="/">Home</a>
        <span style="color: #364FC7">/</span>
        <a href="/opportunities">Opportunities</a>
      </div>
    </section>

    <section class="organization-card-section">
      <CardDetailSection cardId={0} organization="false" dataObj={opportunityDetail} />
    </section>

    <section class="connect-card-section">
      <ConnectCard cardId={0} organization="false" dataObj={opportunityDetail} />
    </section>

    <section class="application">
      <h2>Application</h2>
      <p class="application-text">
        To apply for this opportunity, please visit the official website by clicking the button below.
      </p>
      <a href={opportunityDetail?.applicationDetail ?? "#"} target="_blank" rel="noopener noreferrer">
        <button class="application-button">Apply Now</button>
      </a>
    </section>

    <section class="organization-section">
      <FeaturedOpportunitySection startIndex={0} endIndex={4} title="Other Opportunities" />
    </section>

    <section class="footer-section">
      <Footer />
    </section>
  </main>
</BaseLayout>

<style>
  section {
    padding: 0px 48px;
  }

  .connect-card-section {
    background-color: #cefe00;
  }

  .footer-section {
    background-color: #1a1b1e;
    color: white;
  }

  .application {
    margin: 18px 12%;
  }

  .application-text {
    margin-top: 10px;
    margin-bottom: 10px;
  }

  .application-button {
    background-color: #4258c8;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .application-button:hover {
    background-color: #364FC7;
  }

  @media screen and (max-width: 768px) {
    section {
      padding: 0px;
    }
    .application {
      margin: 18px 20px;
      padding: 10px 12px;
    }
  }
</style>
