---
import '../styles/global.css';
import { Icon } from 'astro-icon/components';
---

<footer class="!bg-[#1a1b1e] !text-white">
  <div class="!max-w-7xl !mx-auto !px-6 lg:!px-8 md:!px-6 sm:!px-4 !py-16">
    <!-- Top: CTA columns -->
    <div class="!grid !grid-cols-1 md:!grid-cols-3 !gap-10 !mb-12">
      <!-- Volunteer -->
      <div>
        <h3 class="!text-xl !font-semibold !mb-3">Join</h3>
        <p class="!text-sm !text-gray-300 !mb-4">Passionate about climate knowledge and action? Help keep Nepal Climate Hub running.</p>
        <a href="/volunteer" class="!inline-flex !items-center !px-4 !py-2 !rounded-lg !bg-[#cefe00] !text-[#1a1b1e] !text-sm !font-medium hover:!bg-white !transition">Volunteer</a>
      </div>

      <!-- Submit profile -->
      <div>
        <h3 class="!text-xl !font-semibold !mb-3">Contribute</h3>
        <p class="!text-sm !text-gray-300 !mb-4">Donâ€™t see your organization on Nepal Climate Hub? Register your profile with us!</p>
        <a href="/contribute" class="!inline-flex !items-center !px-4 !py-2 !rounded-lg !bg-[#cefe00] !text-[#1a1b1e] !text-sm !font-medium hover:!bg-white !transition">Submit profile</a>
      </div>

      <!-- Subscribe -->
      <div>
        <h3 class="!text-xl !font-semibold !mb-3">Stay in the loop</h3>
        <p class="!text-sm !text-gray-300 !mb-3">Subscribe to future news and updates.</p>
        <p class="emailMessage !text-sm !mb-2"></p>
        <form class="form !flex !gap-3" method="post" id="emailForm">
          <input id="userEmail" type="email" placeholder="Email" name="email" autocomplete="off" required class="!w-full !rounded-lg !px-4 !py-2 !bg-white !text-black placeholder:!text-gray-500 !border !border-gray-300 focus:!outline-none focus:!ring-2 focus:!ring-[#cefe00]" />
          <button class="!px-4 !py-2 !rounded-lg !border !border-white hover:!bg-[#cefe00] hover:!text-[#1a1b1e] hover:!border-[#cefe00] !transition">Submit</button>
        </form>

        <!-- Socials -->
        <div class="!mt-6">
          <p class="!text-sm !text-gray-300 !mb-2">Stay connected : )</p>
          <div class="!flex !items-center !gap-4">
            <a href="https://www.linkedin.com/company/nepalclimatehub/" class="icon" aria-label="LinkedIn profile" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin hover:!text-[#cefe00]"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M8 11v5"></path><path d="M8 8v.01"></path><path d="M12 16v-5"></path><path d="M16 16v-3a2 2 0 1 0 -4 0"></path><path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z"></path></svg>
            </a>
            <a href="https://www.instagram.com/nepalclimatehub" class="icon" aria-label="Instagram profile" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-instagram hover:!text-[#cefe00]"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 8a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 4 4h-8a4 4 0 0 1 -4 -4z"></path><path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path><path d="M16.5 7.5v.01"></path></svg>
            </a>
            <a href="https://www.facebook.com/nepalclimatehub" class="icon" aria-label="Facebook profile" target="_blank">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook hover:!text-[#cefe00]"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"></path></svg>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom nav -->
    <div class="!border-t !border-white/10 !pt-8">
      <div class="!flex !flex-col md:!flex-row !items-start md:!items-center !justify-between !gap-6">
        <nav class="!flex !flex-col sm:!flex-row !gap-4 !text-sm">
          <div class="!flex !items-center !gap-2 !flex-wrap">
            <span class="!text-gray-300">CONNECT</span>
            <a href="/organizations" class="hover:!text-[#cefe00]">Organizations</a>
            <span class="!text-gray-500">|</span>
            <a href="/climate-champions" class="hover:!text-[#cefe00]">Climate Champions</a>
            <span class="!text-gray-500">|</span>
            <a href="/events" class="hover:!text-[#cefe00]">Events</a>
          </div>
          <div class="!flex !items-center !gap-2 !flex-wrap">
            <span class="!text-gray-300">LEARN</span>
            <a href="/resources" class="hover:!text-[#cefe00]">Resources</a>
            <span class="!text-gray-500">|</span>
            <a href="/action-steps" class="hover:!text-[#cefe00]">Action Steps</a>
            <span class="!text-gray-500">|</span>
            <a href="/news" class="hover:!text-[#cefe00]">News</a>
          </div>
          <div class="!flex !items-center !gap-2 !flex-wrap">
            <span class="!text-gray-300">NCH.ORG</span>
            <a href="/about" class="hover:!text-[#cefe00]">About</a>
          </div>
        </nav>
        <p class="!text-xs !text-gray-400">&copy; 2025 Nepal Climate Hub. All Rights Reserved.</p>
      </div>
    </div>
  </div>
</footer>

<script>
  const form = document.getElementById("emailForm");

  form?.addEventListener("submit", async function (event) {
    event.preventDefault();
    const form = event.target as HTMLFormElement | null;
    let userEmail = document.getElementById("userEmail") as HTMLInputElement | null;
    let emailMessage = document.querySelector(".emailMessage") as HTMLElement | null;

    if (form && userEmail) {
      let payload = { email: userEmail.value };
      try {
        const response = await fetch("https://nepalclimatehub.org/api/save-subscription-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        (form as HTMLElement).style.display = "none";
        if (response.ok) {
          if (emailMessage) {
            emailMessage.innerText = "Thank you for staying connected!";
            emailMessage.style.display = "block";
            emailMessage.style.color = "#cefe00";
          }
        } else {
          if (emailMessage) {
            emailMessage.innerText = "Email submission failed...Sorry! Contact us.";
            emailMessage.style.display = "block";
            emailMessage.style.color = "red";
          }
        }
      } catch (error) {
        console.error("Error submitting form:", error);
      }
    }
  });
</script>
