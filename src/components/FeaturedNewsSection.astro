---
import "../styles/global.css";
import { Icon } from "astro-icon/components";
// import newsTemp from '../data/newsTemp.json';
import type { NewsItem, NewsTag } from "../types/news"; // Import NewsItem and NewsTag types
import { fetchNews } from "../api"; // Import fetchNews function
// Removed static JSON import
// import unsortedNewsJSON from "../data/news.json";
import sortNewsArray from "../utils/sortNewsArray.js";
import type { SortData } from "../utils/sortNewsArray.js";
import logo from "../assets/logo/secondaryLogo.svg";

// Fetch news data from API
const { data: apiNews } = await fetchNews();
// console.log(apiNews);

const transformedData: SortData[] = (apiNews || []).map((item, index) => ({
  id: index.toString(),
  title: item.title,
  source: item.source,
  mode: item.mode,
  category: item.tags.map((tag: any) => String(tag.tag)),
  publishedDate: item.publishedDate,
  publishedYear: item.publishedYear,
  newsLink: item.newsLink,
  contributedBy: item.contributedBy,
  imgSrc: item.bannerImageUrl,
}));

const NewsJSON = sortNewsArray(transformedData);
---

<div class="!max-w-7xl !mx-auto !px-6 lg:!px-8 md:!px-6 sm:!px-4 !m-20">
  <div class="!mb-8 !flex !items-end !justify-between">
    <div class="!text-left">
      <h2 class="!text-4xl lg:!text-3xl md:!text-2xl !font-bold !text-gray-900 !mb-0">Latest News</h2>
      <p class="!text-lg !text-gray-600">Stay updated with the latest climate news and developments from around the world</p>
    </div>
    <a href="/news" class="!text-sm !font-medium !text-blue-700 hover:!text-blue-800 !transition-colors">View all</a>
  </div>

  <!-- News Grid Container -->
  <div class="!grid !grid-cols-1 lg:!grid-cols-2 xl:!grid-cols-3 !gap-8 !mb-12 ">
    {
      NewsJSON.slice(0, 6).map((news: any) => (
        <article class="group !bg-white !rounded-2xl !shadow-lg hover:!shadow-2xl !transition-all !duration-300 hover:!-translate-y-2 !border !border-gray-100 !overflow-hidden">
          <a href={news.newsLink} target="_blank" class="!block !h-full">
            <!-- Image Section -->
            <div class="!relative !overflow-hidden !h-48 !bg-gradient-to-br !from-blue-50 !to-indigo-50">
              <img
                src={news.imgSrc || logo.src}
                alt={news.title}
                class="!w-full !h-full !object-cover group-hover:!scale-110 !transition-transform !duration-500"
              />
              <div class="!absolute !inset-0 !bg-gradient-to-t !from-black/20 !to-transparent"></div>
            </div>

            <!-- Content Section -->
            <div class="!p-6">
              <h3 class="!text-xl !font-bold !text-gray-900 !mb-3  !transition-colors !duration-300 !overflow-hidden" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
                {news.title}
              </h3>
              
              <!-- Source and Date -->
              <div class="!flex !items-center !justify-between !mb-4">
                <div class="!flex !items-center !text-blue-600 !font-medium">
                  <Icon name="mdi:link" class="!w-4 !h-4 !mr-2" />
                  <span class="!text-sm">{news.source}</span>
                </div>
                <div class="!flex !items-center !text-gray-500">
                  <Icon name="mdi:calendar" class="!w-4 !h-4 !mr-2" />
                  <span class="!text-sm">
                    {new Date(news.publishedDate).toLocaleDateString('en-US', {
                      month: 'short',
                      day: 'numeric',
                      year: 'numeric'
                    })}
                  </span>
                </div>
              </div>

              <!-- Tags/Categories -->
              {news.category && news.category.length > 0 && (
                <div class="!flex !flex-wrap !gap-2 !mb-4">
                  {news.category.slice(0, 2).map((tag: string) => (
                    <span class="!inline-flex !items-center !px-3 !py-1 !text-xs !font-medium !bg-blue-50 !text-blue-700 !border !border-blue-200 !rounded-full">
                      {tag}
                    </span>
                  ))}
                  {news.category.length > 2 && (
                    <span class="!inline-flex !items-center !px-3 !py-1 !text-xs !font-medium !bg-gray-50 !text-gray-600 !border !border-gray-200 !rounded-full">
                      +{news.category.length - 2} more
                    </span>
                  )}
                </div>
              )}

              <!-- Read More Button -->
              <div class="!flex !items-center !text-blue-600 !font-medium group-hover:!text-blue-700 !transition-colors !duration-300">
                <span class="!text-sm">Read Article</span>
                <Icon name="mdi:arrow-right" class="!w-4 !h-4 !ml-2 group-hover:!translate-x-1 !transition-transform !duration-300" />
              </div>
            </div>
          </a>
        </article>
      ))
    }
  </div>
</div>
